import{u as S,j as e,H as E}from"./index-BdWBpXNs.js";import{r as s,u as L}from"./vendor-router-sBGvKeAa.js";import{H as k}from"./Header-BMxedqID.js";import{C as z,B as I}from"./card-CAAq5ZaP.js";import{I as f,A as q}from"./apiEndpoints-Cjc9S1sZ.js";import{L as h,E as g,a as w}from"./label-D2Py_7J7.js";import"./vendor-charts-P8qmgMGQ.js";const R=()=>{const[t,b]=s.useState(""),[i,j]=s.useState(""),[d,y]=s.useState(!1),[l,v]=s.useState(!1),[m,r]=s.useState(""),[u,p]=s.useState(!1),o=L(),{token:n,requiresPassword:c,setRequiresPassword:N}=S();s.useEffect(()=>{if(!n){o("/login",{replace:!0});return}if(!c){o("/dashboard",{replace:!0});return}},[n,c,o]);const P=async a=>{if(a.preventDefault(),r(""),!t||!i){r("Please fill in both password fields.");return}if(t.length<6){r("Password must be at least 6 characters.");return}if(t!==i){r("Passwords do not match.");return}p(!0);try{const x=await fetch(q.updateUserProfile,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({password:t})});if(x.ok)N(!1),o("/dashboard",{replace:!0});else{const C=await x.json().catch(()=>({}));r(C.detail||"Failed to set password. Please try again.")}}catch{r("Something went wrong. Please try again.")}finally{p(!1)}};return!n||!c?null:e.jsxs("div",{className:"min-h-screen lg:fixed lg:inset-0 lg:h-screen lg:overflow-hidden flex flex-col items-center bg-background pt-24 sm:pt-28 md:pt-32 lg:pt-24",children:[e.jsx(E,{children:e.jsx("title",{children:"Create Password - SnoopTrade"})}),e.jsx(k,{}),e.jsx("div",{className:"animate-in fade-in duration-1000 flex-1 flex flex-col min-h-0 items-center justify-center px-4 py-6 lg:py-4 w-[92%] sm:w-[85%] lg:w-[50%] max-w-[500px] mb-8 sm:mb-12 lg:mb-0",children:e.jsxs(z,{className:"p-5 sm:p-8 bg-card border-border shadow-2xl rounded-xl sm:rounded-2xl",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-center text-card-foreground mb-2 font-display",children:"Create a password for your account"}),e.jsx("p",{className:"text-sm text-center text-muted-foreground mb-6",children:"You signed in with Google. Set a password so you can also sign in with email and password."}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",className:"text-card-foreground",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{id:"password",type:d?"text":"password",placeholder:"Enter your password",value:t,onChange:a=>b(a.target.value),required:!0,minLength:6,className:"h-11 pr-10"}),e.jsx("button",{type:"button",onClick:()=>y(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-primary-strong transition-colors",children:d?e.jsx(g,{size:20}):e.jsx(w,{size:20})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"confirmPassword",className:"text-card-foreground",children:"Confirm password"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{id:"confirmPassword",type:l?"text":"password",placeholder:"Confirm your password",value:i,onChange:a=>j(a.target.value),required:!0,minLength:6,className:"h-11 pr-10"}),e.jsx("button",{type:"button",onClick:()=>v(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-primary-strong transition-colors",children:l?e.jsx(g,{size:20}):e.jsx(w,{size:20})})]})]}),m&&e.jsx("div",{role:"alert",className:"login-error-message bg-destructive/30 border border-destructive text-destructive-foreground text-sm p-3 rounded-md text-center font-medium",children:m}),e.jsx(I,{type:"submit",disabled:u,className:"w-full h-12 text-base font-semibold",children:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin"}),e.jsx("span",{children:"Creating..."})]}):"Create password"})]})]})})]})};export{R as default};
